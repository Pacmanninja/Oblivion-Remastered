<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Oblivion Remastered Console Cheat Sheet & Database</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
	<style>
	  .attribution {
	    margin: 0 0 26px 0;
	    font-size: 1em;
	    color: #c7b7de;
	    border-left: 6px solid #8045a0;
	    border-radius: 4px;
	    padding: 9px 20px 7px 16px;
	    background: #30233d;
	  }
	  body {
	    background: #1d1626;
	    color: #f2eafb;
	    font-family: 'Segoe UI', Arial, sans-serif;
	    margin: 0; padding: 0;
	    font-size: 17px;
	  }
	  #container {
	    margin-left: 255px!important; 
	    padding: 30px 30px 50px 30px;
	    min-height: 100vh;
	    box-sizing: border-box;
	  }
	  h1 {
	    font-size: 1.8em;
	    margin: 0 0 18px 0;
	    text-align: center;
	    width: calc(100vw - 60px);
	    max-width: 1000px;
	    margin-left: auto;
	    margin-right: auto;
	    box-sizing: border-box;
	    padding-left: 0;
	    padding-right: 0;
	  }

	  /* --- SIDEBAR --- */
	  .sidebar {
	    max-height: 100vh;
	    width: 220px;
	    background: #221A33;
	    position: fixed;
	    left: 0; top: 0; bottom: 0;
	    overflow-y: auto;            /* improved for tall menus */
	    border-right: 1px solid #a282c3;
	    padding: 30px 15px 10px 20px; /* 10px bottom for li spacing */
	    z-index: 3000;
	    transition: left 0.28s cubic-bezier(.77,0,.175,1);
	    display: flex;
	    flex-direction: column;
	  }
	  .sidebar {
	    /* For Firefox */
	    scrollbar-width: thin;
	    scrollbar-color: #412261 #221A33;  /* thumb color, track (background) */
	  }

	  /* For Chrome, Edge, Safari, Opera */
	  .sidebar::-webkit-scrollbar {
	    width: 10px;
	    background: #221A33;
	  }
	  .sidebar::-webkit-scrollbar-thumb {
	    background: #412261;
	    border-radius: 8px;
	  }
	  .sidebar::-webkit-scrollbar-thumb:hover {
	    background: #633074;  /* Optional: highlight on hover */
	  }
	  .sidebar::-webkit-scrollbar-track {
	    background: #221A33;
	  }
	  .sidebar h2 {
	    margin: 0 0 15px 0;
	    font-size: 1.18em;
	    letter-spacing: 0.05em;
	    color: #E1ADFF;
	    border-radius: 6px;
	    padding: 8px 12px 8px 10px;
	    text-align: left;
	  }
	  .sidebar ul {
	    list-style: none;
	    padding: 0; margin: 0;
	    flex: 1 1 auto;
	    display: flex;
	    flex-direction: column;
	    gap: auto;                             /* Even spacing between items */
	    min-height: 0;
	    height: 100%;
	    justify-content: flex-start;           /* Or 'space-between' for full-justify effect */
	  }
	  .sidebar li {
	    margin: 0;                             /* Remove any default bottom margin */
	  }
	  .sidebar a {
	    color: #E1ADFF; text-decoration: none;
	    font-weight: 500;
	    border-radius: 4px;
	    padding: 3px 7px;
	    display: inline-block;
	    transition: color .13s, background .13s;
	    min-height: auto;
	    line-height: 1.5;
	  }
	  .sidebar a.active, .sidebar a:hover {
	    color: #fff;
	    background: #412261;
	  }
	  .sidebar-toggle {
	    display: none; position: fixed; left: 12px; top: 12px; z-index: 3500;
	    background: none; border: none; padding: 0; cursor: pointer;
	  }
	  .sidebar-toggle svg { width: 32px; height: 32px; }
	  .sidebar-backdrop {
	    display: none;
	    position: fixed; z-index: 3000;
	    left:0; top:0; right:0; bottom:0;
	    background: #18121e88;
	    pointer-events: auto;
	  }

	  /* --- ATTRIBUTION AND SECTION INTROS --- */
	  .attribution {
	    margin: 0 0 26px 0;
	    font-size: 1em;
	    color: #c7b7de;
	    border-left: 6px solid #8045a0;
	    border-radius: 4px;
	    padding: 9px 20px 7px 16px;
	    background: #30233d;
	  }
	  .section-intro {
	    background: #261b36;
	    color: #ded1f7;
	    margin: 18px auto 18px auto;
	    font-size: 1.06em;
	    line-height: 1.65;
	    padding: 11px 20px 9px 16px;
	    border-radius: 4px;
	    width: calc(100vw - 60px);
	    max-width: 1000px;
	    box-sizing: border-box;
	  }

	  /* --- TABLE SECTION HEADERS --- */
	  .table-section {
	    padding-top: 42px;
	    margin-bottom: 28px;
	    display: flex;
	    flex-direction: column;
	    align-items: center;
	  }
	  .table-section h2 {
	    background: #412261;
	    color: #fff;
	    border-radius: 5px;
	    padding: 9px 18px;
	    margin: 0 0 10px 0;
	    font-size: 1.25em;
	    letter-spacing: 0.01rem;
	    border-bottom: 2px solid #a282c3;
	    text-align: center;
	    width: calc(100vw - 60px);
	    max-width: 1000px;
	    margin-left: auto;
	    margin-right: auto;
	    box-sizing: border-box;
	  }

	  /* --- TABLE CONTROLS & FILTERS --- */
	  .table-controls {
	    margin-bottom: 7px;
	    display: flex;
	    gap: 18px;
	    flex-wrap: wrap;
	    align-items: center;
	    justify-content: flex-start;
	    width: calc(100vw - 60px);
	    max-width: 1000px;
	    box-sizing: border-box;
	    margin-left: auto;
	    margin-right: auto;
	  }
	  .table-controls > * {
	    flex: 1 1 0;
	    min-width: 0;
	    max-width: 210px;
	    width: auto;
	  }
	  .searchbox, .length-select, .col-filter-select {
	    background: #232037;
	    border: 1px solid #453057;
	    color: #f1e5ff;
	    border-radius: 4px;
	    font-size: 1em;
	    box-shadow: none;
	    transition: border-color 0.18s, box-shadow 0.18s;
	    min-height: 38px !important;
	    height: 38px !important;
	    padding: 7px 8px !important;
	    width: 100%;
	    max-width: none;
	    box-sizing: border-box;
	  }
	  .searchbox:focus, .col-filter-select:focus, .length-select:focus {
	    border-color: #9c6bdd;
	    box-shadow: 0 0 0 1.5px #8b42d6;
	    outline: none;
	  }
	  .region-type-filter-group label, .region-type-filter-group select {
	    color: #f3eafd;
	  }
	  .region-type-filter-group {
	    display: flex;
	    align-items: center;
	    gap: 7px;
	    margin-left: 18px;
	  }
	  .table-controls .region-type-filter-group {
	    flex-basis: 120px;
	    max-width: 150px;
	    margin-left: 0 !important;
	  }

	  /* --- TABLE AND CELL STYLING --- */
	  .table-wrapper, table {
	    background: #2d223d !important;
	    width: calc(100vw - 60px);
	    max-width: 1000px;
	    box-sizing: border-box;
	    margin-left: auto;
	    margin-right: auto;
	  }
	  .table-wrapper {
	    overflow-x: auto;
	  }
	  table {
	    border-collapse: collapse;
	    width: 100%;
	    margin: 0;
	    color: #faf4ff;
	    display: table;
	  }
	  th, td {
	    border: 1px solid #4b3262;
	    padding: 10px 12px;
	    text-align: left;
	    min-width: 70px;
	    cursor: pointer;
	    user-select: none;
	    transition: background 0.18s, color 0.18s;
	    white-space: pre-line;
	    font-size: 1em;
	    min-height: 44px;
	    box-sizing: border-box;
	  }
	  th {
	    background: #412261;
	    color: #f7eaff;
	    font-weight: bold;
	    position: relative;
	    z-index: 1;
	    border-bottom: 2px solid #a282c3;
	  }
	  th.sorted {
	    background: #633074;
	  }
	  td.copy-highlight, th.copy-highlight {
	    background: #543168 !important;
	  }
	  tr:nth-child(even) td {
	    background: #261b36;
	  }
	  tr:hover td {
	    background: #37294a;
	  }

	  /* --- TABLE FOOTER PAGINATION --- */
	  .table-footer {
	    font-size: .98em;
	    color: #cfc2e7;
	    padding: 4px 0 0 0;
	    display: flex;
	    flex-direction: row;
	    align-items: center;
	    justify-content: flex-start;
	    gap: 12px;
	    width: calc(100vw - 60px);
	    max-width: 1000px;
	    margin: 10px auto 0 auto;
	    box-sizing: border-box;
	  }
	  .table-footer > * {
	    margin: 0;
	  }
	  .table-footer .pag-btn {
	    padding: 3px 12px;
	    border: 1px solid #633070;
	    border-radius: 3px;
	    background: #3b2c4c;
	    color: #d2bcf0;
	    cursor: pointer;
	    font-size: 1em;
	    margin: 0 3px;
	    transition: background .14s;
	    font-weight: 500;
	    min-height: 44px;
	    line-height: 1.5;
	    box-sizing: border-box;
	  }
	  .table-footer .pag-btn:disabled {
	    background: #3a2b4a;
	    color: #6a6070;
	    cursor: not-allowed;
	  }
	  .sort-icon {
	    font-size: 0.93em;
	    margin-left: 4px;
	    color: #e6bfff;
	  }


	  /* --- RESPONSIVE --- */
	  @media (max-width: 650px) {
	    body { font-size: 16px; }
	    #container {
	  	  margin-left: 0 !important;
	  	  padding: 10px 0 30px 0;
	  	  min-width: 0;
	  	  box-sizing: border-box;
	    }
	    /* SIDEBAR */
	    .sidebar-toggle { display: block; }
	    .sidebar {
	  	  position: fixed;
	  	  left: -100vw;
	  	  top: 0; bottom: 0;
	  	  width: 85vw; max-width: 320px;
	  	  border: none;
	  	  padding: 22px 7vw 10px 7vw;
	  	  box-shadow: 2px 0 24px #1118;
	  	  z-index: 3001;
	  	  transition: left 0.28s cubic-bezier(.77,0,.175,1);
	    }
	    .sidebar.open { left: 0; }
	    .sidebar-backdrop { display: none; pointer-events: none; }
	    .sidebar.open + .sidebar-backdrop { display: block; pointer-events: auto; }
	    .sidebar ul {
	  	  gap: 14px;
	    }
	    /* --- Key layout: everything centered, fills screen minus 60px (30px on each side) */
	    .section-intro,
	    .table-section h2,
	    .table-wrapper,
	    .table-controls,
	    .table-footer,
	    table {
	  	  width: calc(100vw - 24px);
	  	  max-width: 100vw;
	  	  min-width: 0;
	  	  margin-left: auto;
	  	  margin-right: auto;
	  	  box-sizing: border-box;
	    }
	    .table-controls {
	  	  gap: 10px;
	  	  flex-direction: row;
	  	  align-items: center;
	  	  justify-content: flex-start;
	  	  flex-wrap: wrap;
	    }
	    .table-controls > * {
	  	  flex: 1 1 0;
	  	  min-width: 0;
	  	  max-width: 210px;
	  	  width: auto;
	    }
	    .searchbox, .length-select, .col-filter-select {
	  	  min-height: 38px !important;
	  	  height: 38px !important;
	  	  max-width: 210px;
	    }
	    .table-footer {
	  	  gap: 7px;
	  	  padding-left: 0;
	  	  padding-right: 0;
	    }
	    th, td {
	  	  padding: 8px 7px;
	  	  font-size: .98em;
	    }
	  }
	  @media (max-width: 450px) {
	    #container {margin-left: 0 !important;}
	    .section-intro,
	    .table-section h2,
	    .table-wrapper,
	    .table-controls,
	    .table-footer,
	    table {
	  	  width: 98vw;
	  	  padding-left: 0 !important;
	  	  padding-right: 0 !important;
	  	  margin-left: auto;
	  	  margin-right: auto;
	  	  box-sizing: border-box;
	    }
	  }

	</style>
</head>
<body>
	<button class="sidebar-toggle" aria-label="Open menu">
		<!-- Simple hamburger icon SVG -->
		<svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true" style="display:block"><rect y="6" width="32" height="4" rx="2" fill="#E1ADFF"/><rect y="14" width="32" height="4" rx="2" fill="#E1ADFF"/><rect y="22" width="32" height="4" rx="2" fill="#E1ADFF"/></svg>
	</button>
  <nav class="sidebar">
    <h2>Catagories</h2>
    <ul id="sidebar-nav"></ul>
  </nav>
  <div class="sidebar-backdrop"></div>
  <div id="container">
    <h1>Oblivion Remastered Command & Data Tables</h1>
    <div class="attribution">
      <b>Original Work Done by 
      <a href="https://www.reddit.com/r/oblivion/comments/1k5y76v/oblivion_remastered_all_item_ids_list_console/" target="_blank">u/opreaadriann</a> 
      at 
      <a href="https://raiderking.com/tes4-oblivion-remastered-all-console-commands-and-ids-items-spells/" target="_blank">raiderking</a>
      <br><sup><i><b>I've since redone the lists and added IDs</b></i></sup>
	  </b>
    </div>
    <div id="tables-root"></div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script>
const ENTRIES_MENU = [10, 25, 50, 100, 250, 500, 1000, "All"];
const sectionText = {
  "How to Use Console Commands": `
    <strong>How to Use Console Commands</strong><br>
    To use console commands in <b>Oblivion Remastered</b>, press the <kbd>~</kbd> key (tilde) on your keyboard while in-game. This will open the console command panel, where you can type or paste commands.
    <br><br>
    <b>If your keyboard does not have a <kbd>~</kbd> key or it doesn't work, you can set up an alternative key:</b><br>
    Navigate to:
    <code>C:\\Users\\Your Username\\Documents\\My Games\\Oblivion Remastered\\Saved\\Config\\Windows</code>, open <code>Input.ini</code> with a text editor.<br>
    Paste the following section or find the existing one:<br>
    <pre style="margin-top:6px;margin-bottom:6px;">[/script/engine.inputsettings]
ConsoleKeys=</pre>
    After <b>=</b> type the key you want to use to open the command console.<br>
    <b>Note:</b> Using <i>any</i> console command will <b>disable achievements</b> for that save file.<br>
    You can restore achievements with a mod such as <a href="https://www.nexusmods.com/oblivionremastered/mods/145" target="_blank">this one</a>.<br>
    <ul style="margin-top:8px;">
      <li>Commands are <b>NOT</b> case-sensitive.</li>
      <li>Some commands accept parameters (often shown in brackets). When entering a command, omit the brackets. For example, input <code>setlevel 10</code> not <code>setlevel [10]</code>.</li>
      <li>Console commands are only available on Windows PC.</li>
    </ul>
  `,
  "Console Commands": `These are the main commands you can use in the console for character control and resource manipulation. Some require parameters, such as an <b>ID</b> or amount.`,
  "All Toggle Commands": `These are commands that you toggle on and off. Using one of these commands twice will usually just revert things back to normal.`,
  "Target Commands": `Cheats used with a target mentioned at the start of the command (example: <code>player.additem f 100</code> gives gold to the player; replacing <code>player</code> with an NPCID targets them).
    <br><b>Tip:</b> You can select NPCs/objects by clicking on them in-game with the console open.`,
  "Quest Commands": `Commands to help fix quest bugs, skip stages, or reveal quest IDs and stages. Use with care, as incorrect usage may affect game stability.`,
  "Armor IDs": `<b>Armor items:</b> Use the ID in console commands like <code>player.additem &lt;ID&gt; 1</code>. Some items have multiple variants.`,
  "Location IDs": `Teleport to locations by name with <code>coc &lt;LocationID&gt;</code>.
				   <br><b>Notice:</b> Some Test cells may crash your game, best to start in a small area/room and then use the command.
				   <br><sup><i>Test Cell*</i> are places that piqued my interest, go on try them out...</sup>`,
};
function slug(str) {
  return str.toLowerCase().replace(/[^a-z0-9]/g, '-').replace(/--+/g, '-').replace(/^-|-$/g, '');
}
function isCopyCol(h) {
  h = (h||"").toLowerCase().trim();
  return h === "example" || h === "command" || h.endsWith("id") ||
    h === "copy paste cheat" || h.includes("id") || h.includes("copy paste cheat");
}
// --- RENDER SIDEBAR ---
function renderSidebar(sectionList) {
  const nav = document.getElementById("sidebar-nav");
  nav.innerHTML = "";
  sectionList.forEach(section => {
    const s = document.createElement('li');
    const l = document.createElement('a');
    l.href = '#' + slug(section.display);
    l.innerText = section.display;
    s.appendChild(l);
    nav.appendChild(s);
  });
}

// ---- MAKE TABLE INTERACTIVE (WITH PAGINATION, FILTER, SORT) ----
function makeTableInteractive(block, rows, headers, sectionName) {
  const table = block.querySelector("table");
  const tbody = table.tBodies[0];
  const searchbox = block.querySelector(".searchbox");
  const lengthSelect = block.querySelector(".length-select");

  // --- NEW: Type Filter (shared for Location IDs and Weapons ID) ---
  let typeFilterSel = block._typeFilterSel || null;
  let typeFilterIdx = block._typeFilterIdx ?? -1;

  // --------- SORT LOGIC ----------
  let sortColumn = null, sortAsc = true;
  function sortRows(rowsArr) {
    if (sortColumn === null) return rowsArr;
    const idx = headers.indexOf(sortColumn);
    if (idx < 0) return rowsArr;
    return rowsArr.slice().sort((a, b) => {
      let x = (a[idx] ?? "").toString().toLowerCase();
      let y = (b[idx] ?? "").toString().toLowerCase();
      let nx = Number(x), ny = Number(y);
      if (!isNaN(nx) && !isNaN(ny)) { x = nx; y = ny; }
      if (x < y) return sortAsc ? -1 : 1;
      if (x > y) return sortAsc ? 1 : -1;
      return 0;
    });
  }

  // -------- PAGINATION STATE ---------
  let allRowsData = rows.slice(1).map(row => row.slice());
  let pageLen = parseInt(lengthSelect.value, 10) || allRowsData.length;
  let page = 0;

  function getRowsFiltered() {
    let out = allRowsData.filter(row => {
      let s = searchbox.value.trim().toLowerCase();
      if (s.length > 0 && row.join(" ").toLowerCase().indexOf(s) === -1) return false;
      // Filter by Type column dropdown if present
      if (typeFilterSel && typeFilterIdx >= 0) {
        let v = typeFilterSel.value;
        if (v && row[typeFilterIdx] != v) return false;
      }
      if (row.every(x => !x)) return false;
      return true;
    });
    return out;
  }

  function renderPage() {
    let viewportRows = getRowsFiltered();
    if (sortColumn !== null) viewportRows = sortRows(viewportRows);
    if (page*pageLen >= viewportRows.length) page = 0;
    let start = page * pageLen,
        end = pageLen === 0 ? viewportRows.length : Math.min(start+pageLen, viewportRows.length),
        rowsNow = viewportRows.slice(start, end);
    tbody.innerHTML = "";
    for (let i = 0; i < rowsNow.length; ++i)
      tbody.appendChild(rowToTr(rowsNow[i], headers.length));
    // --- SORT HEADERS ICON ---
    let ths = table.querySelectorAll('thead th');
    ths.forEach(th=>{
      th.classList.remove('sorted');
      let icon = th.querySelector('.sort-icon');
      if (!icon) {
        icon = document.createElement('span'); icon.className = "sort-icon";
        th.appendChild(icon);
      }
      icon.textContent = '';
      if (sortColumn && th.textContent.replace(/[\u25B2\u25BC]/g,'').trim() === sortColumn) {
        th.classList.add('sorted');
        icon.textContent = sortAsc ? '▲' : '▼';
      }
    });
    // --- PAGINATION CONTROLS ---
    block.querySelector('.table-footer').innerHTML =
      (viewportRows.length === 0 ? 
        "<span>No records found.</span>" :
        `<button class="pag-btn prev-page" ${page===0?'disabled':''}>Previous</button>
         <span>Showing ${start+1}-${end} of ${viewportRows.length}</span>
         <button class="pag-btn next-page" ${end>=viewportRows.length?'disabled':''}>Next</button>`);
    // --- COPY ---
    hookCopyCols(table, headers);
  }
  function rowToTr(row, ncols) {
    let tr = document.createElement("tr");
    for (let i=0;i<ncols;++i) {
      let td = document.createElement("td");
      td.textContent = (row[i] === undefined ? "":row[i]);
      tr.appendChild(td);
    }
    return tr;
  }
  function hookCopyCols(table, headers) {
    const copyCols = [];
    headers.forEach((h,i) => { if (isCopyCol(h)) copyCols.push(i); });
    table.querySelectorAll('tbody tr').forEach(tr => {
      tr.querySelectorAll('td').forEach((td, i) => {
        if (!copyCols.includes(i)) return;
        td.ondblclick = e => {
          const val = td.textContent.trim();
          if (val) {
            if (navigator.clipboard) navigator.clipboard.writeText(val);
            else { let ta=document.createElement('textarea');ta.value=val;document.body.appendChild(ta);ta.select();document.execCommand('copy');document.body.removeChild(ta); }
            td.classList.add('copy-highlight');
            setTimeout(()=>td.classList.remove('copy-highlight'), 420);
          }
        };
      });
    });
  }
  searchbox.oninput = function() { page = 0; renderPage(); };
  lengthSelect.onchange = function() {
    let v = lengthSelect.value;
    pageLen = (v === "All" || v === "") ? 0 : parseInt(v, 10);
    page = 0;
    renderPage();
  };
  if (typeFilterSel) {
    typeFilterSel.onchange = function(){ page = 0; renderPage(); };
  }
  block.querySelector('.table-footer').onclick = function(e){
    if (e.target.classList.contains("next-page") && (page+1)*pageLen < getRowsFiltered().length) { page++; renderPage();}
    if (e.target.classList.contains("prev-page") && page > 0) { page--; renderPage();}
  }
  // --- SORT ON HEADER CLICK
  let ths = table.querySelectorAll('thead th');
  ths.forEach((th, idx) => {
    th.onclick = ()=>{
      let col = th.textContent.replace(/[\u25B2\u25BC]/g,'').trim();
      if (sortColumn === col) sortAsc = !sortAsc;
      else {sortColumn=col; sortAsc=true;}
      renderPage();
    };
  });

  renderPage();
}

async function main() {
  let buf;
  try {
    const cacheBuster = Date.now();
	buf = await fetch(`table.xlsx?v=${cacheBuster}`).then(r=>r.arrayBuffer());
  } catch(e) {
    document.getElementById("tables-root").innerHTML = "<div style='color:#B22;font-weight:bold'>Could not find <code>table.xlsx</code>. Place it next to this HTML and open via a local web server.</div>";
    document.getElementById("sidebar-nav").innerHTML = "";
    return;
  }
  const wb = XLSX.read(buf, {type:"array"});
  const sheets = wb.SheetNames.map(s => ({
    display: s, anchor: slug(s),
    data: XLSX.utils.sheet_to_json(wb.Sheets[s], {header:1,blankrows:false})
  })).filter(sheet => sheet.data && sheet.data.length > 1);

  const sectionList = [
    { display: "How to Use Console Commands", anchor: slug("How to Use Console Commands"), isIntro: true }
  ].concat(sheets);

  renderSidebar(sectionList);

  const root = document.getElementById("tables-root");
  root.innerHTML = "";

  // "How to Use Console Commands" section
  let introDiv = document.createElement("section");
  introDiv.className = "table-section";
  introDiv.id = slug("How to Use Console Commands");
  let h2 = document.createElement("h2");
  h2.textContent = "How to Use Console Commands";
  introDiv.appendChild(h2);
  let intro = document.createElement("div");
  intro.className = "section-intro";
  intro.innerHTML = sectionText["How to Use Console Commands"];
  introDiv.appendChild(intro);
  root.appendChild(introDiv);

  // For all tables/sections from xlsx
  sheets.forEach(sheet => {
    let secDiv = document.createElement("section");
    secDiv.className = "table-section";
    secDiv.id = sheet.anchor;
    let h2 = document.createElement("h2");
    h2.textContent = sheet.display;
    secDiv.appendChild(h2);

    // Section intro if present
    if (sectionText[sheet.display]) {
      let intro = document.createElement("div");
      intro.className = "section-intro";
      intro.innerHTML = sectionText[sheet.display];
      secDiv.appendChild(intro);
    }

    // --- CONTROLS ---
    let controls = document.createElement("div");
    controls.className = "table-controls";
    let search = document.createElement("input");
    search.type = "text";
    search.className = "searchbox";
    search.placeholder = "Search table...";
    controls.appendChild(search);
    let lenSel = document.createElement("select");
    lenSel.className = "length-select";
    ENTRIES_MENU.forEach(n => {
      let o = document.createElement("option");
      o.value = n; o.textContent = n;
      lenSel.appendChild(o);
    });
    lenSel.value = "10";
    controls.appendChild(lenSel);

    let headers = sheet.data[0].map(x => "" + x);
	let lower = sheet.display.toLowerCase();

	// Make filter appear for both "location id" and "weapon id" sheets
	let needsTypeFilter = /location id/i.test(lower) || /weapon id/i.test(lower);

	// For Location IDs, the column is "Region/Type", for Weapon IDs it's "Type"
	let typeColumnNames = [];
	if (/location id/i.test(lower)) typeColumnNames = ["region/type"];
	else if (/weapon id/i.test(lower)) typeColumnNames = ["type"];

	// Try to find the first matching type column
	let typeColIdx = -1;
	let typeColNameForLog = "";
	for (let cname of typeColumnNames) {
	  let idx = headers.findIndex(h => h.trim().toLowerCase() === cname);
	  if (idx >= 0) {
		typeColIdx = idx;
		typeColNameForLog = cname;
		break;
	  }
	}

	if (needsTypeFilter && typeColIdx >= 0) {
	  let typeFilterGroup = document.createElement('div');
	  typeFilterGroup.className = "region-type-filter-group";
	  let label = document.createElement('label');
	  label.innerHTML = "<strong>Filter by Type:</strong>";
	  typeFilterGroup.appendChild(label);

	  let typeFilterSel = document.createElement('select');
	  typeFilterSel.className = "col-filter-select";
	  let opt = document.createElement('option');
	  opt.value = ""; opt.textContent = "All ▼";
	  typeFilterSel.appendChild(opt);

	  let vals = Array.from(new Set(sheet.data.slice(1).map(row => row[typeColIdx]).filter(v => v !== undefined && v !== "")));
	  vals.sort((a, b) => ("" + a).localeCompare("" + b));
	  vals.forEach(v => {
		let o = document.createElement('option');
		o.value = v; o.textContent = v;
		typeFilterSel.appendChild(o);
	  });
	  typeFilterGroup.appendChild(typeFilterSel);
	  controls.appendChild(typeFilterGroup);

	  secDiv._typeFilterSel = typeFilterSel;
	  secDiv._typeFilterIdx = typeColIdx;
	}


    secDiv.appendChild(controls);

    // --- TABLE ---
    let tableWrap = document.createElement("div");
    tableWrap.className = "table-wrapper";
    let table = document.createElement("table");
    let thead = document.createElement("thead");
    let tr = document.createElement("tr");
    headers.forEach(h => {
      let th = document.createElement("th");
      th.textContent = h;
      tr.appendChild(th);
    });
    thead.appendChild(tr);
    table.appendChild(thead);
    let tbody = document.createElement("tbody");
    table.appendChild(tbody);
    tableWrap.appendChild(table);
    secDiv.appendChild(tableWrap);

    // --- FOOTER ---
    let footer = document.createElement("div");
    footer.className = "table-footer";
    secDiv.appendChild(footer);

    root.appendChild(secDiv);
    makeTableInteractive(secDiv, sheet.data, headers, sheet.display);
  });

  // Sidebar active highlight
  function highlightSidebar() {
    let fromTop = window.scrollY + 80;
    let sections = sectionList.map(s => document.getElementById(slug(s.display)));
    let navLinks = Array.from(document.querySelectorAll('.sidebar a'));
    let current = sections.findIndex(sec => sec && sec.offsetTop <= fromTop && fromTop < (sec.offsetTop + sec.offsetHeight));
    navLinks.forEach((l,i) => l.classList.toggle("active", i === current));
  }
  window.addEventListener("scroll", highlightSidebar);
  document.querySelectorAll('.sidebar a').forEach(link=>{
    link.onclick = function(e){
      e.preventDefault();
      let id = link.getAttribute('href').substring(1);
      let sec = document.getElementById(id);
      if (!sec) return;
      scrollTo({top: sec.offsetTop-20,behavior:'smooth'});
    };
  });
}
// ----- Mobile Sidebar with Body Scroll Lock -----
 window.addEventListener('DOMContentLoaded', () => {
  const sidebar = document.querySelector('.sidebar');
  const toggle = document.querySelector('.sidebar-toggle');
  const backdrop = document.querySelector('.sidebar-backdrop');

  function closeSidebar() {
    sidebar.classList.remove('open');
    document.body.style.overflow = '';
  }

  toggle.onclick = () => {
    sidebar.classList.toggle('open');
    document.body.style.overflow = sidebar.classList.contains('open') ? 'hidden' : '';
  };
  backdrop.onclick = closeSidebar;
  // Optional: close sidebar on nav click (mobile UX)
  sidebar.addEventListener('click', e => {
    if(e.target.tagName==='A' && window.innerWidth <= 650) setTimeout(closeSidebar, 200);
  });
});

window.addEventListener('DOMContentLoaded',main);
</script>
</body>
</html>
